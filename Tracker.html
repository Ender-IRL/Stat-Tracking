<!DOCTYPE html>
<!-- v1.2.0 Added most recent action log to top of page -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Stat Tracker</title>
    <style>


#lastActionDisplay {
    font-size: 18px;
    font-weight: bold;
    color: #333;
}

.warning-banner {
    background-color: #f44336; /* Red background */
    color: white;             /* White text */
    text-align: center;       /* Center the text */
    font-size: 10px;          /* Slightly larger text */
    font-weight: bold;        /* Bold text */
    padding: 0px 0;          /* Add some padding */
    position: sticky;         /* Keep it visible at the top */
    top: 0;                   /* Position at the top */
    z-index: 1000;            /* Ensure it stays above other elements */
    border-bottom: 2px solid darkred; /* Add a border for emphasis */
}

        body {
            font-family: Arial, sans-serif;
            background: #f5f7fb;
            color: #0f172a;
        }
        .hidden {
            display: none;
        }
        .hidden-column {
            display: none;
        }
        .game-details, .player-entry, .player-buttons, .stat-buttons, .stat-table {
            margin: 20px;
        }
        input, select, button {
            margin: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            th {
    background-color: grey;
    color: white; /* To ensure text remains readable */
}

        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        .clock {
            font-size: 24px;
            margin: 10px 0;
        }
        .shot-buttons {
    display: grid;
    grid-template-columns: repeat(5, 1fr); /* Adjust for wider layout */
    grid-template-rows: auto auto auto; /* Adjust as needed */
    gap: 20px;
    justify-items: center;
    max-width: 800px;
    margin: 20px auto;
}

.shot-button-group {
    display: flex;
    gap: 5px; /* Space between Make and Miss buttons */
}

.shot-button {
    width: 60px; /* Square size */
    height: 60px;
    font-size: 14px;
    font-weight: bold;
    color: #fff;
    border: none;
    cursor: pointer;
    text-align: center;
}

.shot-button.make {
    background-color: #4CAF50; /* Green for Make */
}

.shot-button.miss {
    background-color: #f44336; /* Red for Miss */
}
.subbed-on {
    background-color: yellow;
}
.subbed-on-button {
    background-color: yellow;
    color: black; /* To ensure the text is readable */
    border: 2px solid #ccc; /* Optional: Adds a subtle border for better visibility */
    font-weight: bold; /* Makes the text stand out */
    transition: background-color 0.3s, color 0.3s; /* Smooth transition for color changes */
}
.shot-buttons {
    position: relative; /* Make the shot-buttons element the reference point */
    display: grid;
    grid-template-columns: repeat(5, 1fr); /* Adjust for wider layout */
    grid-template-rows: auto auto auto; /* Adjust as needed */
    gap: 20px;
    justify-items: center;
    max-width: 800px;
    margin: 20px auto;
}

/* Add the upside-down semi-circle using a pseudo-element */
.shot-buttons::before {
    content: '';
    position: absolute;
    top: 5px; /* Adjust as needed to position the semi-circle correctly */
    left: 50%;
    transform: translateX(-50%) rotate(180deg); /* Center and flip it upside down */
    width: 500px; /* Adjust width for the semi-circle size */
    height: 250px; /* Adjust height for the semi-circle size */
    background-color: #f5deb3; /* Color of the semi-circle, adjust as needed */
    border-top-left-radius: 200px; /* Creates rounded edges */
    border-top-right-radius: 200px; /* Creates rounded edges */
    z-index: -1; /* Place the semi-circle behind the buttons */
    border: 5px solid black; /* Add a black border */
}
/* Positioning the button groups */
.left-corner { grid-area: 1 / 1; }
.short-left { grid-area: 1 / 2; }
.at-rim { grid-area: 1 / 3; }
.short-right { grid-area: 1 / 4; }
.right-corner { grid-area: 1 / 5; }
.left-mid { grid-area: 2 / 2; }
.center-mid { grid-area: 2 / 3; }
.right-mid { grid-area: 2 / 4; }
.left-wing { grid-area: 3 / 1; }
.center-arc { grid-area: 4 / 3; }
.right-wing { grid-area: 3 / 5; }

button[data-stat] {
    width: 120px; /* Increase the width to make the buttons bigger */
    height: 60px; /* Increase the height to make the buttons bigger */
    font-size: 16px; /* Increase the font size for better readability */
    font-weight: bold; /* Keep the bold font for emphasis */
    border-radius: 8px; /* Optional: Adjust border-radius for a smoother look */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    line-height: 1.1;
    padding: 6px;
}
button[data-action] {
    width: 120px; /* Increase the width to make the buttons bigger */
    height: 60px; /* Increase the height to make the buttons bigger */
    font-size: 16px; /* Increase the font size for better readability */
    font-weight: bold; /* Keep the bold font for emphasis */
    border-radius: 8px; /* Optional: Adjust border-radius for a smoother look */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    line-height: 1.1;
    padding: 6px;
}
button[data-putback] {
    width: 120px;
    height: 60px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 8px;
    border: none;
    color: #fff;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    line-height: 1.1;
    padding: 6px;
}
button[data-putback="Make"] {
    background-color: #4CAF50;
}
button[data-putback="Miss"] {
    background-color: #f44336;
}
button[data] {
    width: 120px; /* Increase the width to make the buttons bigger */
    height: 60px; /* Increase the height to make the buttons bigger */
    font-size: 16px; /* Increase the font size for better readability */
    font-weight: bold; /* Keep the bold font for emphasis */
    border-radius: 8px; /* Optional: Adjust border-radius for a smoother look */
}

button[data-stat="Turnover"] {
    background-color: #f44336; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-stat="Steal"] {
    background-color: #24b03b; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-stat="OffensiveRebound"] {
    background-color: #36bbf4; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-stat="DefensiveRebound"] {
    background-color: #36bbf4; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-stat="Block"] {
    background-color: #24b03b; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-stat="FreeThrowMake"] {
    background-color: #24b03b; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-stat="FreeThrowMiss"] {
    background-color: #f44336; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-stat="FoulCommitted"] {
    background-color: #f44336; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-stat="FoulCalled"] {
    background-color: #36bbf4; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-stat="BlockAgainst"] {
    background-color: #f44336; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-action="subOn"] {
    background-color: #d0d70a; /* Bright red color */
    color: #fff; /* White text for contrast */
}
button[data-action="subOff"] {
    background-color: #f436d4; /* Bright red color */
    color: #fff; /* White text for contrast */
}
#playersList button {
    width: 150px; /* Increase the width */
    height: 50px; /* Increase the height */
    font-size: 16px; /* Adjust the font size for better readability */
    font-weight: bold; /* Make the text bold */
    padding: 10px; /* Add padding for a spacious feel */
    border-radius: 5px; /* Round the corners slightly */
    border: 3px solid transparent;
    box-sizing: border-box;
    transition: box-shadow 0.2s ease, border 0.2s ease;
}

#playersList button.selected-player {
    border: 3px solid #00e676;
    box-shadow: 0 0 0 4px rgba(0, 230, 118, 0.6);
    outline: 3px solid #00a84f;
    outline-offset: 2px;
}

/* Style for Assist and Potential Assist buttons */
.assist-button {
    width: 120px; /* Matches other button sizes */
    height: 60px;
    font-size: 16px;
    font-weight: bold;
    border: none;
    color: white;
    border-radius: 8px;
    cursor: pointer;
}

/* Green for Assist */
.assist-button.green {
    background-color: #4CAF50; /* Green */
}

/* Red for Potential Assist */
.assist-button.red {
    background-color: #f44336; /* Red */
}

/* Blue for NO ASSIST */
.assist-button.blue {
    background-color: #2196F3; /* Blue */
}


 .stat-table {
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    padding: 20px;
}

.stat-table-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    flex-wrap: wrap;
}

.stat-table-subtitle {
    margin: 4px 0 0 0;
    color: #64748b;
    font-size: 14px;
}

.tab-bar {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.tab-button {
    background: #e2e8f0;
    border: none;
    border-radius: 8px;
    color: #334155;
    padding: 10px 16px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7);
}

.tab-button.active {
    background: #0f172a;
    color: #ffffff;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
}

.stat-view {
    display: none;
    margin-top: 12px;
}

.stat-view.active {
    display: block;
}

.box-score-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

.box-score-table th {
    background: #0f172a;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.box-score-table th, .box-score-table td {
    border: 1px solid #e2e8f0;
    padding: 8px 6px;
    text-align: center;
}

.box-score-table td:first-child {
    text-align: left;
    font-weight: 700;
}

.box-score-table tfoot td {
    font-weight: 800;
    background: #f8fafc;
}

.shot-chart-controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
    margin: 12px 0 6px;
    color: #334155;
}

.shot-chart-legend {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
    font-size: 12px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.legend-color {
    width: 16px;
    height: 12px;
    border-radius: 4px;
    border: 1px solid #cbd5e1;
    display: inline-block;
}

.legend-color.cold {
    background: #f87171;
}

.legend-color.neutral {
    background: #fbbf24;
}

.legend-color.hot {
    background: #34d399;
}

.shot-chart-wrapper {
    background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
    border: 1px solid #cbd5e1;
    border-radius: 16px;
    padding: 12px;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7);
}

.shot-chart-grid {
    position: relative;
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(4, auto);
    gap: 16px;
    max-width: 820px;
    margin: 0 auto;
    padding: 12px 12px 28px 12px;
}

.chart-zone {
    background: #e2e8f0;
    border: 1px solid #cbd5e1;
    border-radius: 12px;
    min-height: 88px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8);
    transition: background-color 0.25s ease, transform 0.15s ease;
}

.chart-zone .zone-name {
    font-weight: 700;
    font-size: 14px;
    color: #0f172a;
}

.chart-zone .zone-metrics {
    font-size: 12px;
    color: #0f172a;
    margin-top: 6px;
}

.shot-chart-grid::before {
    content: '';
    position: absolute;
    top: 6px;
    left: 50%;
    transform: translateX(-50%) rotate(180deg);
    width: 520px;
    height: 240px;
    background-color: #f5deb3;
    border-top-left-radius: 200px;
    border-top-right-radius: 200px;
    border: 5px solid black;
    z-index: 0;
}

.chart-zone {
    position: relative;
    z-index: 1;
}

.chart-zone.left-corner { grid-area: 1 / 1; }
.chart-zone.short-left { grid-area: 1 / 2; }
.chart-zone.at-rim { grid-area: 1 / 3; }
.chart-zone.short-right { grid-area: 1 / 4; }
.chart-zone.right-corner { grid-area: 1 / 5; }
.chart-zone.left-mid { grid-area: 2 / 2; }
.chart-zone.center-mid { grid-area: 2 / 3; }
.chart-zone.right-mid { grid-area: 2 / 4; }
.chart-zone.left-wing { grid-area: 3 / 1; }
.chart-zone.center-arc { grid-area: 4 / 3; }
.chart-zone.right-wing { grid-area: 3 / 5; }

    </style>
</head>
<body>

    <div class="warning-banner">
        <p>⚠️ Warning: Do Not Refresh Page ⚠️</p>
    </div>
    

    <!-- Game Details Section -->
    <div class="game-details">
        <h2>Game Details</h2>
        <label>Team Number: <input type="text" id="teamNumber"></label>
        <label>Opponent Number: <input type="text" id="opponentNumber"></label>
        <label>Number of Times Played: <input type="text" id="timesPlayed"></label>
        <br>
        <label>Home/Away: 
            <select id="homeAway">
                <option value="Home">Home</option>
                <option value="Away">Away</option>
            </select>
        </label>
        <label>Regular Season/Playoffs: 
            <select id="seasonType">
                <option value="Regular Season">Regular Season</option>
                <option value="Playoffs">Playoffs</option>
            </select>
        </label>
        <br>
        <label>Stat Keeper: <input type="text" id="statKeeper"></label>
    </div>
   <!-- Team Total Points -->
<div class="team-total-points">
    <h2>Team Total Points: <span id="totalPointsDisplay">0</span></h2>
    <h3>Last Action: <span id="lastActionDisplay">None</span></h3>
</div>

    
    <!-- Player Entry Section -->
    <div class="player-entry">
        <h2>Enter Player Names</h2>
        <div id="playerEntries">
            <script>
                for (let i = 1; i <= 52; i++) {
                    document.write(`<label>${i}: <input type="text" id="player${i}"></label><br>`);
                }
            </script>
        </div>
        <button id="enterButton">ENTER</button>
    </div>

    <!-- Game Clock -->
    <div class="clock hidden" id="gameClock">
        <h2>Game Clock: <span id="clockDisplay">00:00</span></h2>
        <button id="startStopClock">Start Clock</button>
    </div>

    <!-- Player Buttons Section -->
    <div class="player-buttons hidden" id="playerButtons">
        <h2>Select a Player</h2>
        <div id="playersList"></div>
        <button id="undoButton">UNDO</button>
    </div>

    <!-- Stat Buttons Section -->
    <div class="stat-buttons hidden" id="statButtons">
        <h2>Select a Stat to Add</h2>
        <button data-stat="OffensiveRebound">Offensive Rebound</button>
        <button data-stat="DefensiveRebound">Defensive Rebound</button>
        <button data-putback="Make">Made Putback</button>
        <button data-putback="Miss">Missed Putback</button>
        <button data-stat="Turnover">Turnover</button>
        <button data-stat="Steal">Steal</button>
        <button data-stat="Block">Block</button>
        <button data-stat="BlockAgainst">Block Against</button>
        <button data-stat="FoulCommitted">Foul Committed</button>
        <button data-stat="FoulCalled">Foul Called</button>
        <button data-stat="FreeThrowMake">Free Throw Make</button>
        <button data-stat="FreeThrowMiss">Free Throw Miss</button>
        <button data-action="subOn">Sub On</button>
        <button data-action="subOff">Sub Off</button>
        <div class="stat-buttons hidden" id="statButtons">
            <h2>Select a Stat to Add</h2>
            <div class="semi-circle"></div> <!-- Added semi-circle element -->
            <button data-stat="OffensiveRebound">Offensive Rebound</button>
            <button data-stat="DefensiveRebound">Defensive Rebound</button>
            <button data-putback="Make">Made Putback</button>
            <button data-putback="Miss">Missed Putback</button>
            <button data-stat="Turnover">Turnover</button>
            <button data-stat="Steal">Steal</button>
            <button data-stat="Block">Block</button>
            <button data-stat="BlockAgainst">Block Against</button>
            <button data-stat="FoulCommitted">Foul Committed</button>
            <button data-stat="FoulCalled">Foul Called</button>
            <button data-stat="FreeThrowMake">Free Throw Make</button>
            <button data-stat="FreeThrowMiss">Free Throw Miss</button>
            <button data-action="subOn">Sub On</button>
            <button data-action="subOff">Sub Off</button>
            <!-- Shot buttons already present -->
        </div>

        <!-- Group 2: Shot Make/Miss Buttons -->
        <div class="shot-buttons">
            <div class="shot-button-group left-corner">
                <button class="shot-button make" data-shot="LeftCornerMake">Left Corner</button>
                <button class="shot-button miss" data-shot="LeftCornerMiss">Left Corner</button>
            </div>
            <div class="shot-button-group short-left">
                <button class="shot-button make" data-shot="ShortLeftMake">Short Left</button>
                <button class="shot-button miss" data-shot="ShortLeftMiss">Short Left</button>
            </div>
            <div class="shot-button-group at-rim">
                <button class="shot-button make" data-shot="AtRimMake">At Rim</button>
                <button class="shot-button miss" data-shot="AtRimMiss">At Rim</button>
            </div>
            <div class="shot-button-group short-right">
                <button class="shot-button make" data-shot="ShortRightMake">Short Right</button>
                <button class="shot-button miss" data-shot="ShortRightMiss">Short Right</button>
            </div>
            <div class="shot-button-group right-corner">
                <button class="shot-button make" data-shot="RightCornerMake">Right Corner</button>
                <button class="shot-button miss" data-shot="RightCornerMiss">Right Corner</button>
            </div>
            <div class="shot-button-group left-mid">
                <button class="shot-button make" data-shot="LeftMidMake">Left Mid</button>
                <button class="shot-button miss" data-shot="LeftMidMiss">Left Mid</button>
            </div>
            <div class="shot-button-group center-mid">
                <button class="shot-button make" data-shot="CenterMidMake">Center Mid</button>
                <button class="shot-button miss" data-shot="CenterMidMiss">Center Mid</button>
            </div>
            <div class="shot-button-group right-mid">
                <button class="shot-button make" data-shot="RightMidMake">Right Mid</button>
                <button class="shot-button miss" data-shot="RightMidMiss">Right Mid</button>
            </div>
            <div class="shot-button-group left-wing">
                <button class="shot-button make" data-shot="LeftWingMake">Left Wing</button>
                <button class="shot-button miss" data-shot="LeftWingMiss">Left Wing</button>
            </div>
            <div class="shot-button-group center-arc">
                <button class="shot-button make" data-shot="CenterArcMake">Center Arc</button>
                <button class="shot-button miss" data-shot="CenterArcMiss">Center Arc</button>
            </div>
            <div class="shot-button-group right-wing">
                <button class="shot-button make" data-shot="RightWingMake">Right Wing</button>
                <button class="shot-button miss" data-shot="RightWingMiss">Right Wing</button>
            </div>
        </div>
        
    </div>

    <div class="assist-buttons hidden" id="assistButtons">
        <h2>Select Assist/Potential Assist Player or No Assist</h2>
        <div id="assistList"></div>
        <button id="noAssistButton">NO ASSIST</button>
    </div>
    

    <!-- Stat Table Section -->
    <div class="stat-table hidden" id="statTable">
        <div class="stat-table-header">
            <div>
                <h2>Stats & Reports</h2>
                <p class="stat-table-subtitle">Toggle views without changing how you track or export.</p>
            </div>
            <div class="tab-bar" id="viewTabs">
                <button class="tab-button active" data-target="rawStatsView">Full Stats</button>
                <button class="tab-button" data-target="boxScoreView">Box Score</button>
                <button class="tab-button" data-target="shotChartView">Shot Charts</button>
            </div>
        </div>

        <div id="rawStatsView" class="stat-view active">
            <table>
                <thead>
                    <tr>
                        <th class="hidden-column">Game ID</th>
                        <th class="hidden-column">Player ID</th>
                        <th class="hidden-column">Date</th>
                        <th>Player Name</th>
                        <th>Offensive Rebound</th>
                        <th>Defensive Rebound</th>
                        <th>Assist</th>
                        <th>Potential Assist</th>
                        <th>Turnover</th>
                        <th>Steal</th>
                        <th>Block</th>
                        <th>Block Against</th>
                        <th>Foul Committed</th>
                        <th>Foul Called</th>
                        <th>FT Make</th>
                        <th>FT Miss</th>
                        <th>Minutes</th>
                        <th>Left Corner Makes</th>
                        <th>Left Corner Misses</th>
                        <th>Short Left Makes</th>
                        <th>Short Left Misses</th>
                        <th>At Rim Makes</th>
                        <th>At Rim Misses</th>
                        <th>Short Right Makes</th>
                        <th>Short Right Misses</th>
                        <th>Right Corner Makes</th>
                        <th>Right Corner Misses</th>
                        <th>Left Mid Makes</th>
                        <th>Left Mid Misses</th>
                        <th>Center Mid Makes</th>
                        <th>Center Mid Misses</th>
                        <th>Right Mid Makes</th>
                        <th>Right Mid Misses</th>
                        <th>Left Wing Makes</th>
                        <th>Left Wing Misses</th>
                        <th>Center Arc Makes</th>
                        <th>Center Arc Misses</th>
                        <th>Right Wing Makes</th>
                        <th>Right Wing Misses</th>
                        <th>Points</th>

                    </tr>
                </thead>
                <tbody id="playerStats"></tbody>
                <tfoot>
                    <tr>
                        <th class="hidden-column">N/A</th>
                        <th class="hidden-column">N/A</th>
                        <th class="hidden-column">N/A</th>
                        <th>Team Totals</th>
                        <td id="teamOffensiveRebound">0</td>
                        <td id="teamDefensiveRebound">0</td>
                        <td id="teamAssist">0</td>
                        <td id="teamPotentialAssist">0</td>
                        <td id="teamTurnover">0</td>
                        <td id="teamSteal">0</td>
                        <td id="teamBlock">0</td>
                        <td id="teamBlockAgainst">0</td>
                        <td id="teamFoulCommitted">0</td>
                        <td id="teamFoulCalled">0</td>
                        <td id="teamFreeThrowMake">0</td>
                        <td id="teamFreeThrowMiss">0</td>
                        <td id="teamMinutes">0</td>
                        <td id="teamLeftCornerMake">0</td>
                        <td id="teamLeftCornerMiss">0</td>
                        <td id="teamShortLeftMake">0</td>
                        <td id="teamShortLeftMiss">0</td>
                        <td id="teamAtRimMake">0</td>
                        <td id="teamAtRimMiss">0</td>
                        <td id="teamShortRightMake">0</td>
                        <td id="teamShortRightMiss">0</td>
                        <td id="teamRightCornerMake">0</td>
                        <td id="teamRightCornerMiss">0</td>
                        <td id="teamLeftMidMake">0</td>
                        <td id="teamLeftMidMiss">0</td>
                        <td id="teamCenterMidMake">0</td>
                        <td id="teamCenterMidMiss">0</td>
                        <td id="teamRightMidMake">0</td>
                        <td id="teamRightMidMiss">0</td>
                        <td id="teamLeftWingMake">0</td>
                        <td id="teamLeftWingMiss">0</td>
                        <td id="teamCenterArcMake">0</td>
                        <td id="teamCenterArcMiss">0</td>
                        <td id="teamRightWingMake">0</td>
                        <td id="teamRightWingMiss">0</td>
                        <td id="teamPoints">0</td>

                    </tr>
                </tfoot>
            </table>
            <div class="export-section">
                <label for="fileName">File Name:</label>
                <input type="text" id="fileName" placeholder="Enter file name">
                <button id="exportButton">Export CSV</button>
            </div>
            <div class="action-log">
                <h2>Action Log</h2>
                <ul id="actionLog" style="list-style-type: none; padding-left: 0;"></ul>
            </div>
        </div>

        <div id="boxScoreView" class="stat-view">
            <table class="box-score-table" id="boxScoreTable">
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>MIN</th>
                        <th>FG</th>
                        <th>FG%</th>
                        <th>3PT</th>
                        <th>3PT%</th>
                        <th>FT</th>
                        <th>FT%</th>
                        <th>OREB</th>
                        <th>DREB</th>
                        <th>REB</th>
                        <th>AST</th>
                        <th>STL</th>
                        <th>BLK</th>
                        <th>TO</th>
                        <th>PF</th>
                        <th>PTS</th>
                    </tr>
                </thead>
                <tbody id="boxScoreBody"></tbody>
                <tfoot>
                    <tr id="boxScoreTeamRow"></tr>
                </tfoot>
            </table>
        </div>

        <div id="shotChartView" class="stat-view">
            <div class="shot-chart-controls">
                <label for="shotChartPlayerSelect">View</label>
                <select id="shotChartPlayerSelect"></select>
                <div class="shot-chart-legend">
                    <span class="legend-item"><span class="legend-color cold"></span>Cold</span>
                    <span class="legend-item"><span class="legend-color neutral"></span>Average</span>
                    <span class="legend-item"><span class="legend-color hot"></span>Hot</span>
                </div>
            </div>
            <div class="shot-chart-wrapper">
                <div class="shot-chart-grid">
                    <div class="chart-zone left-corner" id="zoneBoxLeftCorner" data-zone="LeftCorner">
                        <div class="zone-name">Left Corner 3</div>
                        <div class="zone-metrics" id="zoneTextLeftCorner">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone short-left" id="zoneBoxShortLeft" data-zone="ShortLeft">
                        <div class="zone-name">Short Left</div>
                        <div class="zone-metrics" id="zoneTextShortLeft">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone at-rim" id="zoneBoxAtRim" data-zone="AtRim">
                        <div class="zone-name">At Rim</div>
                        <div class="zone-metrics" id="zoneTextAtRim">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone short-right" id="zoneBoxShortRight" data-zone="ShortRight">
                        <div class="zone-name">Short Right</div>
                        <div class="zone-metrics" id="zoneTextShortRight">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone right-corner" id="zoneBoxRightCorner" data-zone="RightCorner">
                        <div class="zone-name">Right Corner 3</div>
                        <div class="zone-metrics" id="zoneTextRightCorner">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone left-mid" id="zoneBoxLeftMid" data-zone="LeftMid">
                        <div class="zone-name">Left Mid</div>
                        <div class="zone-metrics" id="zoneTextLeftMid">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone center-mid" id="zoneBoxCenterMid" data-zone="CenterMid">
                        <div class="zone-name">Center Mid</div>
                        <div class="zone-metrics" id="zoneTextCenterMid">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone right-mid" id="zoneBoxRightMid" data-zone="RightMid">
                        <div class="zone-name">Right Mid</div>
                        <div class="zone-metrics" id="zoneTextRightMid">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone left-wing" id="zoneBoxLeftWing" data-zone="LeftWing">
                        <div class="zone-name">Left Wing 3</div>
                        <div class="zone-metrics" id="zoneTextLeftWing">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone center-arc" id="zoneBoxCenterArc" data-zone="CenterArc">
                        <div class="zone-name">Center Arc 3</div>
                        <div class="zone-metrics" id="zoneTextCenterArc">0/0 (--%)</div>
                    </div>
                    <div class="chart-zone right-wing" id="zoneBoxRightWing" data-zone="RightWing">
                        <div class="zone-name">Right Wing 3</div>
                        <div class="zone-metrics" id="zoneTextRightWing">0/0 (--%)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const playerData = {};
        let selectedPlayer = null;
        const history = []; // Stack to track history of stats added
        let gameClockInterval = null;
        let gameClockRunning = false;
        let gameTime = 0;
        const threePointZones = ['LeftCorner', 'RightCorner', 'LeftWing', 'RightWing', 'CenterArc'];
        const twoPointZones = ['ShortLeft', 'AtRim', 'ShortRight', 'LeftMid', 'CenterMid', 'RightMid'];
        const zoneAverages = {
            atRim: 0.6,
            midRange: 0.4,
            three: 0.3
        };
        const zoneRange = 0.2; // +/- range for max green/red around expected
        const maxAttemptsForIntensity = 10; // attempts needed to reach full color intensity
        const zoneCategoryLookup = {
            LeftCorner: 'three',
            RightCorner: 'three',
            LeftWing: 'three',
            RightWing: 'three',
            CenterArc: 'three',
            AtRim: 'atRim',
            ShortLeft: 'midRange',
            ShortRight: 'midRange',
            LeftMid: 'midRange',
            CenterMid: 'midRange',
            RightMid: 'midRange'
        };
        const zoneConfig = {
            LeftCorner: { make: 'LeftCornerMake', miss: 'LeftCornerMiss' },
            RightCorner: { make: 'RightCornerMake', miss: 'RightCornerMiss' },
            LeftWing: { make: 'LeftWingMake', miss: 'LeftWingMiss' },
            RightWing: { make: 'RightWingMake', miss: 'RightWingMiss' },
            CenterArc: { make: 'CenterArcMake', miss: 'CenterArcMiss' },
            ShortLeft: { make: 'ShortLeftMake', miss: 'ShortLeftMiss' },
            AtRim: { make: 'AtRimMake', miss: 'AtRimMiss' },
            ShortRight: { make: 'ShortRightMake', miss: 'ShortRightMiss' },
            LeftMid: { make: 'LeftMidMake', miss: 'LeftMidMiss' },
            CenterMid: { make: 'CenterMidMake', miss: 'CenterMidMiss' },
            RightMid: { make: 'RightMidMake', miss: 'RightMidMiss' }
        };

        const tabButtons = document.querySelectorAll('#viewTabs .tab-button');
        tabButtons.forEach((button) => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.stat-view').forEach(view => view.classList.remove('active'));
                button.classList.add('active');
                const target = document.getElementById(button.dataset.target);
                if (target) {
                    target.classList.add('active');
                }
            });
        });

        document.getElementById('enterButton').addEventListener('click', () => {
            const teamNumber = document.getElementById('teamNumber').value.padStart(2, '0'); // Pad to 2 digits
            const opponentNumber = document.getElementById('opponentNumber').value.padStart(2, '0'); // Pad to 2 digits
            const timesPlayed = document.getElementById('timesPlayed').value;
            const homeAway = document.getElementById('homeAway').value === 'Home' ? '01' : '00';
            const seasonType = document.getElementById('seasonType').value === 'Regular Season' ? '1' : '2';
            const gameID = `1${homeAway === '01' ? teamNumber : opponentNumber}${homeAway === '01' ? opponentNumber : teamNumber}${seasonType}${timesPlayed}`;

            // Get current date
            const currentDate = new Date().toISOString().split('T')[0]; // Format as YYYY-MM-DD

            // Collect player names and show player buttons
            for (let i = 1; i <= 52; i++) {
                const playerName = document.getElementById(`player${i}`).value;
                if (playerName) {
                    const playerID = `1${teamNumber}${i.toString().padStart(2, '0')}`; // Create player ID
                    playerData[i] = {
                        name: playerName,
                        playerID: playerID,
                        stats: {
                            OffensiveRebound: 0,
                            DefensiveRebound: 0,
                            Assist: 0,
                            PotentialAssist: 0,
                            Turnover: 0,
                            Steal: 0,
                            Block: 0,
                            BlockAgainst: 0,
                            FoulCommitted: 0,
                            FoulCalled: 0,
                            FreeThrowMake: 0,
                            FreeThrowMiss: 0,
                            LeftCornerMake: 0,
                            LeftCornerMiss: 0,
                            ShortLeftMake: 0,
                            ShortLeftMiss: 0,
                            AtRimMake: 0,
                            AtRimMiss: 0,
                            ShortRightMake: 0,
                            ShortRightMiss: 0,
                            RightCornerMake: 0,
                            RightCornerMiss: 0,
                            LeftMidMake: 0,
                            LeftMidMiss: 0,
                            CenterMidMake: 0,
                            CenterMidMiss: 0,
                            RightMidMake: 0,
                            RightMidMiss: 0,
                            LeftWingMake: 0,
                            LeftWingMiss: 0,
                            CenterArcMake: 0,
                            CenterArcMiss: 0,
                            RightWingMake: 0,
                            RightWingMiss: 0,
                            Minutes: 0
                        },
                        isPlaying: false, 
                        lastSubTime: 0 
                    };
                }
            }

            document.querySelector('.game-details').classList.add('hidden');
            document.querySelector('.player-entry').classList.add('hidden');
            document.getElementById('gameClock').classList.remove('hidden');

             const playersListDiv = document.getElementById('playersList');
             playersListDiv.innerHTML = '';
            selectedPlayer = null;
             for (let i in playerData) {
                 const button = document.createElement('button');
                 button.innerText = `${i}: ${playerData[i].name}`;
                 button.dataset.playerNumber = i;
                 playersListDiv.appendChild(button);
             }
             document.getElementById('playerButtons').classList.remove('hidden');
            document.getElementById('statButtons').classList.remove('hidden');

            const playerStatsBody = document.getElementById('playerStats');
            playerStatsBody.innerHTML = '';
            for (let i in playerData) {
                const row = document.createElement('tr');
                row.id = `playerRow${i}`;
                row.innerHTML = `
                    <td class="hidden-column">${gameID}</td>
                    <td class="hidden-column">${playerData[i].playerID}</td>
                    <td class="hidden-column">${currentDate}</td>
                    <td>${playerData[i].name}</td>
                    <td id="offensiverebound${i}">0</td>
                    <td id="defensiverebound${i}">0</td>
                    <td id="assist${i}">0</td>
                    <td id="potentialassist${i}">0</td>
                    <td id="turnover${i}">0</td>
                    <td id="steal${i}">0</td>
                    <td id="block${i}">0</td>
                    <td id="blockagainst${i}">0</td>
                    <td id="foulcommitted${i}">0</td>
                    <td id="foulcalled${i}">0</td>
                    <td id="freethrowmake${i}">0</td>
                    <td id="freethrowmiss${i}">0</td>
                    <td id="minutes${i}">00:00</td>
                    <td id="leftcornermake${i}">0</td>
                    <td id="leftcornermiss${i}">0</td>
                    <td id="shortleftmake${i}">0</td>
                    <td id="shortleftmiss${i}">0</td>
                    <td id="atrimmake${i}">0</td>
                    <td id="atrimmiss${i}">0</td>
                    <td id="shortrightmake${i}">0</td>
                    <td id="shortrightmiss${i}">0</td>
                    <td id="rightcornermake${i}">0</td>
                    <td id="rightcornermiss${i}">0</td>
                    <td id="leftmidmake${i}">0</td>
                    <td id="leftmidmiss${i}">0</td>
                    <td id="centermidmake${i}">0</td>
                    <td id="centermidmiss${i}">0</td>
                    <td id="rightmidmake${i}">0</td>
                    <td id="rightmidmiss${i}">0</td>
                    <td id="leftwingmake${i}">0</td>
                    <td id="leftwingmiss${i}">0</td>
                    <td id="centerarcmake${i}">0</td>
                    <td id="centerarcmiss${i}">0</td>
                    <td id="rightwingmake${i}">0</td>
                    <td id="rightwingmiss${i}">0</td>
                    <td id="points${i}">0</td>

                `;
                playerStatsBody.appendChild(row);
            }
            document.getElementById('statTable').classList.remove('hidden');
            populateShotChartSelect();
            renderBoxScore();
            updateShotChart('team');
        });

        document.getElementById('playerButtons').addEventListener('click', (e) => {
            const playerButton = e.target.closest('#playersList button');
            if (!playerButton) {
                return;
            }

            selectedPlayer = playerButton.dataset.playerNumber;
            document.querySelectorAll('#playersList button').forEach(btn => btn.classList.remove('selected-player'));
            playerButton.classList.add('selected-player');
        });

        document.getElementById('statButtons').addEventListener('click', (e) => {
    const targetButton = e.target.closest('button');
    if (!targetButton) {
        return;
    }

    if (!selectedPlayer || !playerData[selectedPlayer]) {
        alert('Please select a player before logging stats.');
        return;
    }

    const playerStats = playerData[selectedPlayer].stats;
    const playerName = playerData[selectedPlayer].name;
    const playerNumber = selectedPlayer;

    if (targetButton.dataset.putback) {
        const shotTimestamp = formatGameTime(gameTime);
        const shotStat = targetButton.dataset.putback === 'Make' ? 'AtRimMake' : 'AtRimMiss';

        playerStats.OffensiveRebound += 1;
        history.push({ player: selectedPlayer, stat: 'OffensiveRebound', amount: 1 });
        document.getElementById(`offensiverebound${selectedPlayer}`).innerText = playerStats.OffensiveRebound;
        updateTeamTotals('OffensiveRebound');
        logAction(`${playerNumber} ${playerName} grabbed an offensive rebound`, shotTimestamp);

        playerStats[shotStat] += 1;
        history.push({ player: selectedPlayer, stat: shotStat, amount: 1 });
        document.getElementById(`${shotStat.toLowerCase()}${selectedPlayer}`).innerText = playerStats[shotStat];
        updateTeamTotals(shotStat);
        calculatePoints(selectedPlayer);

        if (shotStat === 'AtRimMake') {
            logAction(`${playerNumber} ${playerName} made a 2-pointer from at rim`, shotTimestamp);
        } else {
            logAction(`${playerNumber} ${playerName} missed a 2-pointer from at rim`, shotTimestamp);
        }

        return;
    }

    if (targetButton.dataset.stat) {
        const stat = targetButton.dataset.stat;
        playerStats[stat] += 1;
        history.push({ player: selectedPlayer, stat: stat, amount: 1 });
        document.getElementById(`${stat.toLowerCase()}${selectedPlayer}`).innerText = playerStats[stat];
        updateTeamTotals(stat);
        calculatePoints(selectedPlayer);

        // Log different stats with specific messages
        let message;
        switch (stat) {
            case "OffensiveRebound":
                message = `${playerNumber} ${playerName} grabbed an offensive rebound`;
                break;
            case "DefensiveRebound":
                message = `${playerNumber} ${playerName} grabbed a defensive rebound`;
                break;
            case "Turnover":
                message = `${playerNumber} ${playerName} committed a turnover`;
                break;
            case "Steal":
                message = `${playerNumber} ${playerName} made a steal`;
                break;
            case "Block":
                message = `${playerNumber} ${playerName} blocked a shot`;
                break;
            case "BlockAgainst":
                message = `${playerNumber} ${playerName} got blocked`;
                break;
            case "FoulCommitted":
                message = `${playerNumber} ${playerName} committed a foul`;
                break;
            case "FoulCalled":
                message = `${playerNumber} ${playerName} called a foul`;
                break;
            case "FreeThrowMake":
                message = `${playerNumber} ${playerName} made a free throw`;
                break;
            case "FreeThrowMiss":
                message = `${playerNumber} ${playerName} missed a free throw`;
                break;
            default:
                message = `${playerNumber} ${playerName} recorded a ${stat}`;
                break;
        }

        // Log the action
        logAction(message);
    }



    if (targetButton.dataset.shot) {
    const shot = targetButton.dataset.shot;
    playerStats[shot] += 1;
    history.push({ player: selectedPlayer, stat: shot, amount: 1 });
    document.getElementById(`${shot.toLowerCase()}${selectedPlayer}`).innerText = playerStats[shot];
    updateTeamTotals(shot);

    const playerName = playerData[selectedPlayer].name;
    const playerNumber = selectedPlayer;
    const shotType = /corner|wing|arc/i.test(shot) ? "3-pointer" : "2-pointer";
    const location = formatLocation(shot.replace("Make", "").replace("Miss", ""));
    calculatePoints(selectedPlayer);
    // Capture the current game time as the timestamp for this shot and its assist
    const shotTimestamp = formatGameTime(gameTime);

    // Log the shot action with the timestamp
    if (shot.includes("Make")) {
        logAction(`${playerNumber} ${playerName} made a ${shotType} from ${location}`, shotTimestamp);
        showAssistButtons(selectedPlayer, shotTimestamp);  // Pass the timestamp to showAssistButtons
    } else if (shot.includes("Miss")) {
        logAction(`${playerNumber} ${playerName} missed a ${shotType} from ${location}`, shotTimestamp);
        showPotentialAssistButtons(selectedPlayer, shotTimestamp);  // Pass the timestamp to showPotentialAssistButtons
    }
}



if (targetButton.dataset.action === 'subOn') {
    subOn(selectedPlayer);
}

if (targetButton.dataset.action === 'subOff') {
    subOff(selectedPlayer);
}

});


function subOn(player) {
    if (!playerData[player].isPlaying) {
        playerData[player].isPlaying = true;
        playerData[player].lastSubTime = gameTime;
        logAction(`${player} ${playerData[player].name} subbed on`);

        // Add the 'subbed-on-button' class to highlight the player button
        const playerButton = document.querySelector(`[data-player-number="${player}"]`);
        if (playerButton) {
            playerButton.classList.add('subbed-on-button');
        }
    }
    renderBoxScore();
}

function subOff(player) {
    if (playerData[player].isPlaying) {
        const timeOnCourt = gameTime - playerData[player].lastSubTime;
        playerData[player].stats.Minutes += timeOnCourt / 60;
        playerData[player].isPlaying = false;
        document.getElementById(`minutes${player}`).innerText = formatTime(playerData[player].stats.Minutes * 60);
        logAction(`${player} ${playerData[player].name} subbed off`);

        // Remove the 'subbed-on-button' class
        const playerButton = document.querySelector(`[data-player-number="${player}"]`);
        if (playerButton) {
            playerButton.classList.remove('subbed-on-button');
        }
    }
    renderBoxScore();
}

document.getElementById('undoButton').addEventListener('click', () => {
    while (history.length > 0) {
        const lastAction = history.pop();
        const { player, stat, amount } = lastAction;

        // Check if the action is a "subOn" or "subOff" and skip it
        if (stat === "subOn" || stat === "subOff") {
            continue; // Skip sub actions
        }

        // Revert the stat in playerData
        playerData[player].stats[stat] -= amount;
        document.getElementById(`${stat.toLowerCase()}${player}`).innerText = playerData[player].stats[stat];
        updateTeamTotals(stat);

        // Remove the most recent non-sub entry from the action log
        const actionLog = document.getElementById('actionLog');
        for (let i = 0; i < actionLog.children.length; i++) {
            if (!actionLog.children[i].textContent.includes("subbed on") && !actionLog.children[i].textContent.includes("subbed off")) {
                actionLog.removeChild(actionLog.children[i]);
                break;
            }
        }

        // Update the Last Action display with the new most recent action
        updateLastActionDisplay();

        break; // Only undo one action
    }
});

// Function to update the Last Action display
function updateLastActionDisplay() {
    const actionLog = document.getElementById('actionLog');
    const lastLogEntry = actionLog.firstChild;

    if (lastLogEntry) {
        document.getElementById('lastActionDisplay').textContent = lastLogEntry.textContent;
    } else {
        document.getElementById('lastActionDisplay').textContent = 'None';
    }
}


function updateTeamTotals(stat) {
    let teamTotal = 0;
    for (let i in playerData) {
        if (playerData[i].stats[stat] !== undefined) {
            teamTotal += playerData[i].stats[stat];
        }
    }

    const footerId = `team${stat.charAt(0).toUpperCase() + stat.slice(1)}`;
    if (document.getElementById(footerId)) {
        document.getElementById(footerId).innerText = teamTotal;
    }

    // Update team points total
    updateTeamPoints();
    renderBoxScore();
    updateShotChart();
}

function updateTeamPoints() {
    let teamPointsTotal = 0;
    for (let i in playerData) {
        teamPointsTotal += calculatePoints(i);
    }
    document.getElementById('teamPoints').innerText = teamPointsTotal;
    document.getElementById('totalPointsDisplay').innerText = teamPointsTotal; // Update display at top
}




        document.getElementById('startStopClock').addEventListener('click', () => {
            if (!gameClockRunning) {
                startGameClock();
                document.getElementById('startStopClock').innerText = 'Stop Clock';
            } else {
                stopGameClock();
                document.getElementById('startStopClock').innerText = 'Start Clock';
            }
        });

        function startGameClock() {
            gameClockRunning = true;
            gameClockInterval = setInterval(() => {
                gameTime += 1;
                updateClockDisplay();
                updatePlayerMinutes();
            }, 1000);
        }

        function stopGameClock() {
            gameClockRunning = false;
            clearInterval(gameClockInterval);
        }

        function updateClockDisplay() {
            const minutes = Math.floor(gameTime / 60);
            const seconds = gameTime % 60;
            document.getElementById('clockDisplay').innerText = `${pad(minutes)}:${pad(seconds)}`;
        }

        function updatePlayerMinutes() {
            for (let i in playerData) {
                if (playerData[i].isPlaying) {
                    const timeOnCourt = gameTime - playerData[i].lastSubTime;
                    document.getElementById(`minutes${i}`).innerText = formatTime((playerData[i].stats.Minutes * 60) + timeOnCourt);
                }
            }
            renderBoxScore();
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${pad(minutes)}:${pad(remainingSeconds)}`;
        }

        function pad(num) {
            return num.toString().padStart(2, '0');
        }



        function toggleAssistMode(showAssist) {
    const statButtons = document.getElementById('statButtons');
    const assistButtons = document.getElementById('assistButtons');
    if (!statButtons || !assistButtons) {
        return;
    }
    if (showAssist) {
        statButtons.classList.add('hidden');
        assistButtons.classList.remove('hidden');
    } else {
        assistButtons.classList.add('hidden');
        statButtons.classList.remove('hidden');
    }
}




        function showAssistButtons(shooter, shotTimestamp) {
    const assistListDiv = document.getElementById('assistList');
    assistListDiv.innerHTML = '';  // Clear existing assist buttons

    for (let i in playerData) {
        if (i !== shooter && playerData[i].isPlaying) {
            const button = document.createElement('button');
            button.innerText = `#${i} ${playerData[i].name}`;  // Include player number and name
            button.dataset.assistPlayer = i;
            button.classList.add('assist-button', 'green'); // Add assist button styling
            assistListDiv.appendChild(button);

        }
    }

    toggleAssistMode(true);
    document.getElementById('noAssistButton').classList.add('assist-button', 'blue');

    assistListDiv.replaceChildren(...assistListDiv.children);

    assistListDiv.onclick = (e) => {
        if (e.target.dataset.assistPlayer) {
            const assistPlayer = e.target.dataset.assistPlayer;
            playerData[assistPlayer].stats.Assist += 1;
            history.push({ player: assistPlayer, stat: 'Assist', amount: 1 });
            document.getElementById(`assist${assistPlayer}`).innerText = playerData[assistPlayer].stats.Assist;
            updateTeamTotals("Assist");

            // Use the shot's timestamp for logging the assist
            logAction(`${assistPlayer} ${playerData[assistPlayer].name} had an assist`, shotTimestamp);

            toggleAssistMode(false);
        }
    };

    document.getElementById('noAssistButton').onclick = () => {
        toggleAssistMode(false);
    };
}


function showPotentialAssistButtons(shooter, shotTimestamp) {
    const assistListDiv = document.getElementById('assistList');
    assistListDiv.innerHTML = '';  // Clear existing assist buttons

    for (let i in playerData) {
        if (i !== shooter && playerData[i].isPlaying) {
            const button = document.createElement('button');
            button.innerText = `#${i} ${playerData[i].name}`;  // Include player number and name
            button.dataset.potentialAssistPlayer = i;
            button.classList.add('assist-button', 'red'); // Add potential assist button styling
            assistListDiv.appendChild(button);



        }
    }

    toggleAssistMode(true);
    document.getElementById('noAssistButton').classList.add('assist-button', 'blue');
    assistListDiv.replaceChildren(...assistListDiv.children);

    assistListDiv.onclick = (e) => {
        if (e.target.dataset.potentialAssistPlayer) {
            const potentialAssistPlayer = e.target.dataset.potentialAssistPlayer;
            playerData[potentialAssistPlayer].stats.PotentialAssist = 
                (playerData[potentialAssistPlayer].stats.PotentialAssist || 0) + 1;
            history.push({ player: potentialAssistPlayer, stat: 'PotentialAssist', amount: 1 });
            document.getElementById(`potentialassist${potentialAssistPlayer}`).innerText = 
                playerData[potentialAssistPlayer].stats.PotentialAssist;
            updateTeamTotals("PotentialAssist");

            // Use the shot's timestamp for logging the potential assist
            logAction(`${potentialAssistPlayer} ${playerData[potentialAssistPlayer].name} had a potential assist`, shotTimestamp);

            toggleAssistMode(false);

        }
    };

    document.getElementById('noAssistButton').onclick = () => {
        toggleAssistMode(false);

    };
}

// Function to export table data as CSV
document.getElementById('exportButton').addEventListener('click', () => {
    const fileName = document.getElementById('fileName').value || 'basketball_stats';
    const table = document.querySelector('#statTable table');
    let csvContent = '';

    // Collect headers
    const headers = [];
    table.querySelectorAll('thead th').forEach(th => {
        headers.push(th.textContent.trim());
    });
    csvContent += headers.join(',') + '\n';

    // Collect rows from tbody, skipping rows with 0 minutes played
    table.querySelectorAll('tbody tr').forEach(row => {
        const rowData = [];
        let skipRow = false;

        row.querySelectorAll('td').forEach((cell, index) => {
            let cellText = cell.textContent.trim();
            
            // Check if the column is "Minutes" and value is 0 or 00:00
            if (headers[index].toLowerCase().includes('minutes')) {
                if (cellText === '0' || cellText === '00:00') {
                    skipRow = true; // Mark the row to be skipped
                }
            }
            rowData.push(cellText);
        });

        if (!skipRow) {
            csvContent += rowData.join(',') + '\n';
        }
    });

    // Collect team totals from tfoot
    const footerData = [];
    table.querySelectorAll('tfoot td, tfoot th').forEach((cell, index) => {
        let cellText = cell.textContent.trim();

        // Format team totals for the Minutes column if applicable
        if (headers[index] && headers[index].toLowerCase().includes('minutes') && cellText.includes(':')) {
            cellText = formatTimeToHHMMSS(cellText);
        }
        footerData.push(cellText);
    });
    csvContent += footerData.join(',') + '\n';

    // Add a separator for clarity between table data and action log
    csvContent += '\nAction Log\n';

    // Reverse the action log and append it to CSV content
    const actionLogEntries = Array.from(document.getElementById('actionLog').children);
    actionLogEntries.reverse().forEach(logEntry => {
        csvContent += logEntry.textContent.trim() + '\n';
    });

    // Trigger CSV download
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.setAttribute('download', `${fileName}.csv`);
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
});



// Action Logging
function logAction(message, timestamp = null) {
    const actionLog = document.getElementById('actionLog');
    const logEntry = document.createElement('li');

    // Use the provided timestamp or get the current game time
    const time = timestamp ? timestamp : formatGameTime(gameTime);

    // Prepend the time to the message
    logEntry.textContent = `${time} ${message}`;

    // Insert the new log entry at the top
    actionLog.insertBefore(logEntry, actionLog.firstChild);

    // Update the Last Action display
    document.getElementById('lastActionDisplay').textContent = `${time} ${message}`;
}


//Formatting location for action log
function formatLocation(location) {
    return location
        .replace(/([A-Z])/g, ' $1')  // Add space before each uppercase letter
        .toLowerCase()               // Convert to lowercase
        .trim();                     // Remove any leading/trailing spaces
}

// Formatting time for the action log, I guess this is needed...?
function formatGameTime(timeInSeconds) {
    const minutes = Math.floor(timeInSeconds / 60);
    const seconds = timeInSeconds % 60;
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
}

function formatTimeToHHMMSS(timeStr) {
    const [minutes, seconds] = timeStr.split(':').map(Number);
    const hours = Math.floor(minutes / 60);
    const remainingMinutes = minutes % 60;
    return `${hours.toString().padStart(2, '0')}:${remainingMinutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function calculatePoints(player) {
    const stats = playerData[player].stats;
    const points = (stats.FreeThrowMake * 1) +
                   (stats.LeftCornerMake * 3) + (stats.ShortLeftMake * 2) +
                   (stats.AtRimMake * 2) + (stats.ShortRightMake * 2) +
                   (stats.RightCornerMake * 3) + (stats.LeftMidMake * 2) +
                   (stats.CenterMidMake * 2) + (stats.RightMidMake * 2) +
                   (stats.LeftWingMake * 3) + (stats.CenterArcMake * 3) +
                   (stats.RightWingMake * 3);

    document.getElementById(`points${player}`).innerText = points;
    return points;
}

function buildBoxScoreLine(stats) {
    const threeMakes = threePointZones.reduce((total, zone) => total + (stats[`${zone}Make`] || 0), 0);
    const threeMisses = threePointZones.reduce((total, zone) => total + (stats[`${zone}Miss`] || 0), 0);
    const twoMakes = twoPointZones.reduce((total, zone) => total + (stats[`${zone}Make`] || 0), 0);
    const twoMisses = twoPointZones.reduce((total, zone) => total + (stats[`${zone}Miss`] || 0), 0);

    const fgMakes = threeMakes + twoMakes;
    const fgAttempts = fgMakes + threeMisses + twoMisses;
    const threeAttempts = threeMakes + threeMisses;
    const ftMakes = stats.FreeThrowMake || 0;
    const ftAttempts = ftMakes + (stats.FreeThrowMiss || 0);
    const oreb = stats.OffensiveRebound || 0;
    const dreb = stats.DefensiveRebound || 0;
    const reb = oreb + dreb;

    return {
        fgMakes,
        fgAttempts,
        threeMakes,
        threeAttempts,
        ftMakes,
        ftAttempts,
        oreb,
        dreb,
        reb,
        ast: stats.Assist || 0,
        stl: stats.Steal || 0,
        blk: stats.Block || 0,
        tov: stats.Turnover || 0,
        pf: stats.FoulCommitted || 0,
        points: (ftMakes * 1) + (twoMakes * 2) + (threeMakes * 3)
    };
}

function formatPercent(makes, attempts) {
    if (!attempts) {
        return '--%';
    }
    return `${((makes / attempts) * 100).toFixed(1)}%`;
}

function getLiveSeconds(playerKey) {
    const player = playerData[playerKey];
    if (!player) {
        return 0;
    }
    let seconds = (player.stats.Minutes || 0) * 60;
    if (player.isPlaying) {
        seconds += (gameTime - player.lastSubTime);
    }
    return Math.max(0, Math.round(seconds));
}

function renderBoxScore() {
    const body = document.getElementById('boxScoreBody');
    const teamRow = document.getElementById('boxScoreTeamRow');
    if (!body || !teamRow) {
        return;
    }

    body.innerHTML = '';

    const totals = {
        fgMakes: 0,
        fgAttempts: 0,
        threeMakes: 0,
        threeAttempts: 0,
        ftMakes: 0,
        ftAttempts: 0,
        oreb: 0,
        dreb: 0,
        reb: 0,
        ast: 0,
        stl: 0,
        blk: 0,
        tov: 0,
        pf: 0,
        points: 0,
        minutes: 0
    };

    for (let i in playerData) {
        const player = playerData[i];
        const line = buildBoxScoreLine(player.stats);
        const secondsPlayed = getLiveSeconds(i);

        totals.fgMakes += line.fgMakes;
        totals.fgAttempts += line.fgAttempts;
        totals.threeMakes += line.threeMakes;
        totals.threeAttempts += line.threeAttempts;
        totals.ftMakes += line.ftMakes;
        totals.ftAttempts += line.ftAttempts;
        totals.oreb += line.oreb;
        totals.dreb += line.dreb;
        totals.reb += line.reb;
        totals.ast += line.ast;
        totals.stl += line.stl;
        totals.blk += line.blk;
        totals.tov += line.tov;
        totals.pf += line.pf;
        totals.points += line.points;
        totals.minutes += secondsPlayed;

        const row = document.createElement('tr');
        row.innerHTML = `
            <td>#${i} ${player.name}</td>
            <td>${formatTime(secondsPlayed)}</td>
            <td>${line.fgMakes}-${line.fgAttempts}</td>
            <td>${formatPercent(line.fgMakes, line.fgAttempts)}</td>
            <td>${line.threeMakes}-${line.threeAttempts}</td>
            <td>${formatPercent(line.threeMakes, line.threeAttempts)}</td>
            <td>${line.ftMakes}-${line.ftAttempts}</td>
            <td>${formatPercent(line.ftMakes, line.ftAttempts)}</td>
            <td>${line.oreb}</td>
            <td>${line.dreb}</td>
            <td>${line.reb}</td>
            <td>${line.ast}</td>
            <td>${line.stl}</td>
            <td>${line.blk}</td>
            <td>${line.tov}</td>
            <td>${line.pf}</td>
            <td>${line.points}</td>
        `;
        body.appendChild(row);
    }

    teamRow.innerHTML = `
        <td>Team</td>
        <td>${formatTime(totals.minutes)}</td>
        <td>${totals.fgMakes}-${totals.fgAttempts}</td>
        <td>${formatPercent(totals.fgMakes, totals.fgAttempts)}</td>
        <td>${totals.threeMakes}-${totals.threeAttempts}</td>
        <td>${formatPercent(totals.threeMakes, totals.threeAttempts)}</td>
        <td>${totals.ftMakes}-${totals.ftAttempts}</td>
        <td>${formatPercent(totals.ftMakes, totals.ftAttempts)}</td>
        <td>${totals.oreb}</td>
        <td>${totals.dreb}</td>
        <td>${totals.reb}</td>
        <td>${totals.ast}</td>
        <td>${totals.stl}</td>
        <td>${totals.blk}</td>
        <td>${totals.tov}</td>
        <td>${totals.pf}</td>
        <td>${totals.points}</td>
    `;
}

function populateShotChartSelect() {
    const select = document.getElementById('shotChartPlayerSelect');
    if (!select) {
        return;
    }
    select.innerHTML = '';

    const teamOption = document.createElement('option');
    teamOption.value = 'team';
    teamOption.textContent = 'Team (All Players)';
    select.appendChild(teamOption);

    for (let i in playerData) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `#${i} ${playerData[i].name}`;
        select.appendChild(option);
    }

    select.value = 'team';
}

function getZoneTotals(selection) {
    const totals = {};
    Object.keys(zoneConfig).forEach((zone) => {
        totals[zone] = { makes: 0, misses: 0 };
    });

    const targets = selection === 'team' ? Object.keys(playerData) : [selection];

    targets.forEach((playerKey) => {
        const stats = playerData[playerKey]?.stats;
        if (!stats) {
            return;
        }
        Object.entries(zoneConfig).forEach(([zone, keys]) => {
            totals[zone].makes += stats[keys.make] || 0;
            totals[zone].misses += stats[keys.miss] || 0;
        });
    });

    return totals;
}

function hexToRgb(hex) {
    const sanitized = hex.replace('#', '');
    const value = parseInt(sanitized, 16);
    return {
        r: (value >> 16) & 255,
        g: (value >> 8) & 255,
        b: value & 255
    };
}

function interpolateColor(startHex, endHex, t) {
    const start = hexToRgb(startHex);
    const end = hexToRgb(endHex);

    const r = Math.round(start.r + (end.r - start.r) * t);
    const g = Math.round(start.g + (end.g - start.g) * t);
    const b = Math.round(start.b + (end.b - start.b) * t);

    return `rgb(${r}, ${g}, ${b})`;
}

function getZoneColorForZone(zone, pct, attempts) {
    if (!attempts) {
        return '#e2e8f0';
    }
    const category = zoneCategoryLookup[zone] || 'midRange';
    const expected = zoneAverages[category] ?? 0.4;
    const spread = zoneRange || 0.2;
    const maxAttempts = maxAttemptsForIntensity || 10;

    const intensity = Math.min(attempts / maxAttempts, 1); // how far from white the color should move
    const diff = pct === null ? 0 : pct - expected;
    const normalized = Math.max(-1, Math.min(1, diff / spread));

    // Hue: 0 red, 60 yellow, 120 green (driven by shot quality)
    const hue = 60 + normalized * 60;

    // Pull color close to white for low-attempt zones, saturate/darken as attempts accumulate
    const targetSaturation = 70;
    const targetLightness = 55;
    const saturation = 5 + intensity * (targetSaturation - 5);
    const lightness = 96 - intensity * (96 - targetLightness);

    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}

function updateShotChart(selection = null) {
    const select = document.getElementById('shotChartPlayerSelect');
    if (!select) {
        return;
    }

    const target = selection || select.value || 'team';
    if (!select.value) {
        select.value = target;
    }

    const totals = getZoneTotals(target);
    Object.entries(totals).forEach(([zone, data]) => {
        const attempts = data.makes + data.misses;
        const pct = attempts ? data.makes / attempts : null;
        const box = document.getElementById(`zoneBox${zone}`);
        const text = document.getElementById(`zoneText${zone}`);

        if (box) {
            box.style.backgroundColor = getZoneColorForZone(zone, pct, attempts);
        }

        if (text) {
            const pctText = attempts ? `${Math.round(pct * 100)}%` : '--%';
            text.textContent = `${data.makes}/${attempts || 0} (${pctText})`;
        }
    });
}

document.getElementById('shotChartPlayerSelect').addEventListener('change', (e) => {
    updateShotChart(e.target.value);
});




</script>
</body>
</html>
